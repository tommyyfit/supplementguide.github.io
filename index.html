<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Supplement Guide</title>
    <meta name="description" content="Interaktivn√≠ pr≈Øvodce dopl≈àky stravy pro s√≠lu, zdrav√≠ a energii. Vytvo≈ôte si vlastn√≠ stack a z√≠skejte tipy na kombinace.">
    <meta name="author" content="tommyyfit">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%232563eb' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M13 10V3L4 14h7v7l9-11h-7z'/></svg>">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        brand: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 900: '#1e3a8a' },
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f8fafc;
            color: #0f172a;
            -webkit-tap-highlight-color: transparent;
        }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        .card-hover { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-hover:active { transform: scale(0.98); }
        @media (min-width: 768px) {
            .card-hover:hover { transform: translateY(-4px); box-shadow: 0 12px 20px -5px rgba(0, 0, 0, 0.1); }
        }

        #toast-container {
            position: fixed; top: 1rem; right: 1rem; z-index: 100;
            display: flex; flex-direction: column; gap: 0.5rem; pointer-events: none;
        }
        .toast { pointer-events: auto; min-width: 300px; max-width: 90vw; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

        /* Kategorie Badges */
        .cat-badge-S√≠la { background: #fff7ed; color: #c2410c; border: 1px solid #ffedd5; }
        .cat-badge-Zdrav√≠ { background: #f0fdf4; color: #15803d; border: 1px solid #dcfce7; }
        .cat-badge-Energie { background: #fefce8; color: #a16207; border: 1px solid #fef9c3; }
        .cat-badge-Sp√°nek { background: #eff6ff; color: #1d4ed8; border: 1px solid #dbeafe; }
        .cat-badge-Nootropika { background: #faf5ff; color: #7e22ce; border: 1px solid #f3e8ff; }

        .icon-bg-S√≠la { background: #fff7ed; }
        .icon-bg-Zdrav√≠ { background: #f0fdf4; }
        .icon-bg-Energie { background: #fefce8; }
        .icon-bg-Sp√°nek { background: #eff6ff; }
        .icon-bg-Nootropika { background: #faf5ff; }

        /* Confidence Indicators */
        .conf-high { border-left: 4px solid #22c55e; }
        .conf-medium { border-left: 4px solid #eab308; }
        
        /* Interactive Badge Styles */
        .badge-conf-link { 
            transition: all 0.2s; 
            display: inline-flex; 
            align-items: center; 
            gap: 4px; 
            text-decoration: none !important;
        }
        .badge-conf-link:hover { transform: scale(1.05); filter: brightness(0.95); }

        .badge-conf-high { background-color: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .badge-conf-medium { background-color: #fef9c3; color: #854d0e; border: 1px solid #fde047; }
    </style>
</head>

<body class="antialiased min-h-screen flex flex-col">

    <div id="toast-container"></div>

    <header class="bg-white/80 backdrop-blur-md border-b border-slate-200 sticky top-0 z-40 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="bg-brand-600 text-white p-1.5 rounded-lg shadow-sm">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                </div>
                <h1 class="text-xl font-bold tracking-tight text-slate-900 hidden sm:block">Supplement<span class="text-brand-600">Guide</span></h1>
            </div>

            <div class="flex items-center gap-3">
                <div class="relative">
                    <select id="user-gender" class="bg-white border border-slate-200 text-slate-700 text-sm rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 block p-2 pr-8 font-medium cursor-pointer hover:bg-slate-50 transition shadow-sm">
                        <option value="male">Mu≈æ üë®</option>
                        <option value="female">≈Ωena üë©</option>
                    </select>
                </div>

                <div class="flex items-center gap-2 bg-white border border-slate-200 rounded-lg px-3 py-1.5 focus-within:ring-2 focus-within:ring-brand-500 transition shadow-sm relative group">
                    <span class="text-xs font-semibold text-slate-500 uppercase tracking-wide hidden sm:block">V√°ha</span>
                    <input type="number" id="user-weight" value="80" class="w-10 bg-transparent text-sm font-bold text-slate-900 text-center focus:outline-none border-none placeholder-slate-300" placeholder="kg">
                    <span class="text-sm text-slate-400 font-medium">kg</span>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-8 grid grid-cols-1 lg:grid-cols-12 gap-8">

        <aside class="lg:col-span-4 space-y-6 order-1 lg:order-1">
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-5 sticky top-24 transition-all">
                <div class="flex items-center justify-between mb-4 border-b border-slate-100 pb-4">
                    <h2 class="text-lg font-bold text-slate-800 flex items-center gap-2">
                        <svg class="w-5 h-5 text-brand-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                        </svg>
                        M≈Øj Stack
                    </h2>
                    <div class="flex items-center gap-2">
                        <span id="stack-count" class="bg-brand-100 text-brand-700 text-xs font-bold px-2.5 py-0.5 rounded-full">0</span>
                        <button onclick="clearStack()" class="text-xs text-slate-400 hover:text-red-500 font-medium transition underline decoration-dotted" title="Vymazat v≈°e">Reset</button>
                    </div>
                </div>

                <div id="stack-empty" class="text-center py-12">
                    <div class="w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-3">
                        <svg class="w-8 h-8 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                    </div>
                    <p class="text-sm font-medium text-slate-500">Stack je pr√°zdn√Ω</p>
                    <p class="text-xs text-slate-400 mt-1">Vyber dopl≈àky z katalogu</p>
                </div>

                <div id="stack-analysis" class="hidden space-y-5">
                    <div class="bg-slate-50 border border-slate-100 p-3 rounded-lg space-y-2">
                        <div class="text-xs text-slate-500 flex justify-between items-center">
                            <span>Profil:</span>
                            <strong id="profile-display" class="text-slate-800">Mu≈æ, 80kg</strong>
                        </div>
                    </div>

                    <div id="warnings-container" class="hidden p-4 bg-red-50 border border-red-100 rounded-lg">
                        <h3 class="text-xs font-bold text-red-700 uppercase tracking-wide mb-2 flex items-center gap-2">‚ö†Ô∏è Pozor na kombinace</h3>
                        <ul id="warnings-list" class="text-sm text-red-800 space-y-2 list-disc pl-4"></ul>
                    </div>

                    <div id="suggestions-container" class="hidden p-4 bg-indigo-50 border border-indigo-100 rounded-lg">
                        <h3 class="text-xs font-bold text-indigo-700 uppercase tracking-wide mb-2 flex items-center gap-2">üí° Tip experta</h3>
                        <ul id="suggestions-list" class="text-sm text-indigo-800 space-y-2"></ul>
                    </div>

                    <div>
                        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wide mb-4 border-b border-slate-100 pb-2">Rozvrh Dne</h3>
                        <div class="relative pl-4 space-y-6">
                            <div class="relative pl-6 border-l-2 border-slate-100 pb-2">
                                <span class="absolute -left-[9px] top-0 w-4 h-4 bg-yellow-400 rounded-full border-2 border-white shadow-sm"></span>
                                <h4 class="text-sm font-bold text-slate-800 mb-2">R√°no / Dopoledne</h4>
                                <div id="schedule-morning" class="space-y-2 text-xs text-slate-500 italic min-h-[1rem]">--</div>
                            </div>
                            <div class="relative pl-6 border-l-2 border-slate-100 pb-2">
                                <span class="absolute -left-[9px] top-0 w-4 h-4 bg-red-500 rounded-full border-2 border-white shadow-sm"></span>
                                <h4 class="text-sm font-bold text-slate-800 mb-2">P≈ôed Tr√©ninkem</h4>
                                <div id="schedule-pre" class="space-y-2 text-xs text-slate-500 italic min-h-[1rem]">--</div>
                            </div>
                            <div class="relative pl-6 border-l-2 border-slate-100 pb-2">
                                <span class="absolute -left-[9px] top-0 w-4 h-4 bg-green-500 rounded-full border-2 border-white shadow-sm"></span>
                                <h4 class="text-sm font-bold text-slate-800 mb-2">Po Tr√©ninku</h4>
                                <div id="schedule-post" class="space-y-2 text-xs text-slate-500 italic min-h-[1rem]">--</div>
                            </div>
                            <div class="relative pl-6 border-l-2 border-slate-100">
                                <span class="absolute -left-[9px] top-0 w-4 h-4 bg-indigo-500 rounded-full border-2 border-white shadow-sm"></span>
                                <h4 class="text-sm font-bold text-slate-800 mb-2">Veƒçer / Sp√°nek</h4>
                                <div id="schedule-evening" class="space-y-2 text-xs text-slate-500 italic min-h-[1rem]">--</div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-3 gap-2 pt-4 border-t border-slate-100">
                        <button onclick="saveStackProfile()" class="flex items-center justify-center gap-2 bg-slate-100 hover:bg-slate-200 text-slate-700 text-xs font-bold py-2.5 rounded-lg transition" title="Ulo≈æit do prohl√≠≈æeƒçe">
                            <span>üíæ</span> Ulo≈æit
                        </button>
                        <button onclick="exportStackText()" class="flex items-center justify-center gap-2 bg-brand-50 hover:bg-brand-100 text-brand-700 text-xs font-bold py-2.5 rounded-lg transition" title="St√°hnout jako soubor">
                            <span>üìÑ</span> Export
                        </button>
                        <button onclick="copyStackToClipboard()" class="flex items-center justify-center gap-2 bg-brand-50 hover:bg-brand-100 text-brand-700 text-xs font-bold py-2.5 rounded-lg transition" title="Zkop√≠rovat do schr√°nky">
                            <span>üìã</span> Kop√≠rovat
                        </button>
                    </div>
                </div>

                <div id="saved-profiles-area" class="mt-6 pt-4 border-t border-slate-200 hidden">
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wide mb-3">Ulo≈æen√© Stacky</h3>
                    <div id="saved-profiles-list" class="space-y-2"></div>
                </div>
            </div>
        </aside>

        <section class="lg:col-span-8 order-2 lg:order-2">
            <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200 mb-6 flex flex-col sm:flex-row gap-4 items-center justify-between sticky top-[5rem] z-50">
                <div class="relative w-full sm:w-72">
                    <input type="text" id="search-input" placeholder="Hledat (nap≈ô. kreatin, sp√°nek)..." class="w-full pl-10 pr-4 py-2.5 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent text-sm shadow-sm transition-all">
                    <svg class="w-5 h-5 text-slate-400 absolute left-3 top-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
                <div class="flex gap-2 overflow-x-auto pb-2 sm:pb-0 w-full sm:w-auto scrollbar-hide" id="category-filters">
                    <button class="filter-btn active px-4 py-1.5 rounded-full text-xs font-bold bg-slate-800 text-white shadow transition transform hover:scale-105" data-cat="All">V≈°e</button>
                    <button class="filter-btn px-4 py-1.5 rounded-full text-xs font-medium bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 transition" data-cat="S√≠la">S√≠la</button>
                    <button class="filter-btn px-4 py-1.5 rounded-full text-xs font-medium bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 transition" data-cat="Zdrav√≠">Zdrav√≠</button>
                    <button class="filter-btn px-4 py-1.5 rounded-full text-xs font-medium bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 transition" data-cat="Sp√°nek">Sp√°nek</button>
                    <button class="filter-btn px-4 py-1.5 rounded-full text-xs font-medium bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 transition" data-cat="Energie">Energie</button>
                    <button class="filter-btn px-4 py-1.5 rounded-full text-xs font-medium bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 transition" data-cat="Nootropika">Nootropika</button>
                </div>
            </div>

            <div id="catalog-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5 pb-10"></div>
        </section>
    </main>

    <div id="modal-backdrop" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4 opacity-0 transition-opacity duration-300">
        <div id="modal-content" class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto transform scale-95 transition-all duration-300 flex flex-col">

            <div class="p-6 pb-4 relative border-b border-slate-100 sticky top-0 bg-white z-10">
                <button onclick="closeModal()" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 p-2 rounded-full hover:bg-slate-100 transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
                <div class="flex items-center gap-4">
                    <div id="m-icon" class="w-14 h-14 rounded-2xl flex items-center justify-center text-3xl shadow-inner bg-slate-50">üíä</div>
                    <div>
                        <div class="flex gap-2 mb-1">
                            <span id="m-category" class="text-[10px] font-bold uppercase tracking-widest px-2 py-0.5 rounded border">Kategorie</span>
                            <span id="m-confidence"></span>
                        </div>
                        <h2 id="m-title" class="text-2xl font-bold text-slate-900 leading-tight">N√°zev</h2>
                    </div>
                </div>
            </div>

            <div class="p-6 space-y-6">
                <p id="m-desc" class="text-slate-600 leading-relaxed"></p>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="bg-green-50 p-4 rounded-xl border border-green-100">
                        <h3 class="text-xs font-bold text-green-800 uppercase mb-2">Hlavn√≠ Benefity</h3>
                        <ul id="m-benefits" class="text-sm text-green-900 space-y-1"></ul>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                        <h3 class="text-xs font-bold text-blue-800 uppercase mb-2">D√°vkov√°n√≠</h3>
                        <p class="text-sm text-blue-900 mb-1"><span class="font-semibold">Mno≈æstv√≠:</span> <span id="m-dosage"></span></p>
                        <p class="text-sm text-blue-900"><span class="font-semibold">Kdy:</span> <span id="m-timing"></span></p>
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <h3 class="text-xs font-bold text-slate-400 uppercase mb-2">Synergie (Vhodn√© s)</h3>
                        <div id="m-synergy" class="flex flex-wrap gap-2"></div>
                    </div>
                    <div>
                        <h3 class="text-xs font-bold text-slate-400 uppercase mb-2">Konflikty (Pozor na)</h3>
                        <div id="m-conflict" class="flex flex-wrap gap-2"></div>
                    </div>
                </div>
            </div>

            <div class="p-4 border-t border-slate-100 bg-slate-50 rounded-b-2xl flex justify-end sticky bottom-0 z-10">
                <button id="m-toggle-btn" class="w-full sm:w-auto bg-slate-900 text-white px-8 py-3 rounded-xl font-semibold hover:bg-slate-800 transition shadow-lg active:scale-95">
                    P≈ôidat do Stacku
                </button>
            </div>
        </div>
    </div>

    <footer class="grid-cols-1 text-center text-brand-700 border-l-2 ">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 text-xs font-medium">
            ¬© 2025 Supplement Guide. V≈°echna pr√°va vyhrazena. | Vytvo≈ôil <a href="https://beacons.ai/tommyy.fit">tommyyfit</a>
        </div>
    </footer>

    <script>
// --- 0. URL CLEANUP (Remove .html from visual URL) ---
        // Pou≈æ√≠v√° History API k odstranƒõn√≠ '.html' z adresy URL, ani≈æ by do≈°lo k naƒçten√≠ nov√© str√°nky.
        // PODM√çNKA: Spust√≠ se POUZE, pokud NEN√ç pou≈æito lok√°ln√≠ sch√©ma 'file:///', co≈æ ≈ôe≈°√≠ SecurityError.
        if (window.location.protocol !== 'file:') {
            if (window.location.pathname.endsWith('.html')) {
                const newUrl = window.location.pathname.replace(/\.html$/, '') + window.location.search;
                window.history.replaceState(null, '', newUrl);
            }
        }

        // --- 1. DATA (TOP 50) + Confidence + Links ---
        const supplements = [
            // --- KATEGORIE: S√çLA A V√ùKON ---
            { id: 1, name: "Kreatin Monohydr√°t", category: "S√≠la", confidence: "high", link: "https://examine.com/supplements/creatine/", icon: "‚ö°", description: "Zvy≈°uje z√°soby ATP. Nejv√≠ce prozkouman√Ω doplnƒõk pro s√≠lu.", benefits: ["Zvy≈°uje s√≠lu", "Svalov√Ω objem", "V√Ωbu≈°nost"], dosage: "5g dennƒõ", timing: "Kdykoliv (ide√°lnƒõ po tr√©ninku)", synergy: ["Sacharidy", "Voda", "Beta-Alanin"], conflict: [] },
            { id: 2, name: "Syrov√°tkov√Ω Protein", category: "S√≠la", confidence: "high", link: "https://examine.com/supplements/whey-protein/", icon: "ü•õ", description: "Rychle straviteln√° b√≠lkovina s vysokou biologickou hodnotou.", benefits: ["Rychl√° regenerace", "R≈Øst sval≈Ø"], dosage: "20-40g", timing: "Po tr√©ninku / Svaƒçina", synergy: ["Kreatin", "Sacharidy"], conflict: [] },
            { id: 3, name: "Kasein (Micel√°rn√≠)", category: "S√≠la", confidence: "high", link: "https://examine.com/supplements/casein-protein/", icon: "üåô", description: "Pomal√Ω protein, uvol≈àuje aminokyseliny a≈æ 7 hodin.", benefits: ["Noƒçn√≠ regenerace", "Antikatabolick√Ω"], dosage: "30g", timing: "P≈ôed span√≠m", synergy: ["Probiotika"], conflict: [] },
            { id: 4, name: "L-Citrulin Mal√°t", category: "S√≠la", confidence: "high", link: "https://examine.com/supplements/citrulline/", icon: "üçâ", description: "Zvy≈°uje oxid dusnat√Ω (NO) a pr≈Øtok krve svaly. √öƒçinnƒõj≈°√≠ ne≈æ Arginin.", benefits: ["Svalov√° pumpa", "Odd√°len√≠ √∫navy", "Sn√≠≈æen√≠ bolesti"], dosage: "6-8g", timing: "P≈ôed tr√©ninkem (30 min)", synergy: ["S≈Øl", "Arginin"], conflict: [] },
            { id: 5, name: "Beta-Alanin", category: "S√≠la", confidence: "high", link: "https://examine.com/supplements/beta-alanine/", icon: "üêú", description: "Zvy≈°uje hladinu karnosinu, sni≈æuje zakyselen√≠ (lakt√°t).", benefits: ["Svalov√° vytrvalost", "V√Ωkon v s√©ri√≠ch 60s+"], dosage: "3-5g", timing: "P≈ôed tr√©ninkem", synergy: ["Kreatin"], conflict: [] },
            { id: 6, name: "EAA (Esenci√°ln√≠ AK)", category: "S√≠la", confidence: "medium", link: "https://examine.com/supplements/bcaa/", icon: "üß¨", description: "Komplex 9 esenci√°ln√≠ch aminokyselin. U≈æiteƒçn√©, pokud nen√≠ dost b√≠lkovin ve stravƒõ.", benefits: ["Ochrana sval≈Ø", "Regenerace bez kalori√≠"], dosage: "10-15g", timing: "Bƒõhem tr√©ninku (Intra)", synergy: ["Elektrolyty"], conflict: [] },
            { id: 7, name: "HMB", category: "S√≠la", confidence: "medium", link: "https://examine.com/supplements/hmb/", icon: "üõë", description: "Metabolit leucinu. Data jsou sm√≠≈°en√°, nejlep≈°√≠ efekt u zaƒç√°teƒçn√≠k≈Ø.", benefits: ["Antikatabolick√Ω efekt", "Regenerace"], dosage: "3g", timing: "P≈ôed tr√©ninkem", synergy: ["Kreatin"], conflict: [] },
            { id: 8, name: "Betain (Trimethylglycin)", category: "S√≠la", confidence: "medium", link: "https://examine.com/supplements/betaine/", icon: "üöÄ", description: "Osmolyt podporuj√≠c√≠ hydrataci bunƒõk a v√Ωbu≈°nost.", benefits: ["V√Ωbu≈°n√° s√≠la", "Proteosynt√©za"], dosage: "2.5g", timing: "P≈ôed tr√©ninkem", synergy: ["Kreatin"], conflict: [] },
            { id: 9, name: "Taurin", category: "S√≠la", confidence: "medium", link: "https://examine.com/supplements/taurine/", icon: "üêÇ", description: "Aminokyselina pro hydrataci bunƒõk a funkci nerv≈Ø.", benefits: ["Prevence k≈ôeƒç√≠", "Srdeƒçn√≠ zdrav√≠"], dosage: "1-2g", timing: "P≈ôed tr√©ninkem", synergy: ["Elektrolyty"], conflict: [] },
            { id: 10, name: "Elektrolyty", category: "S√≠la", confidence: "high", link: "https://pubmed.ncbi.nlm.nih.gov/?term=electrolytes+exercise+hydration", icon: "üíß", description: "Miner√°ly (Na, K, Mg) ztracen√© potem. Kritick√© pro v√Ωkon.", benefits: ["Hydratace", "V√Ωkon", "Proti k≈ôeƒç√≠m"], dosage: "Dle pocen√≠", timing: "Bƒõhem tr√©ninku", synergy: ["Voda", "Sacharidy"], conflict: [] },
            { id: 11, name: "Arginin A-KG", category: "S√≠la", confidence: "medium", link: "https://examine.com/supplements/arginine/", icon: "ü©∏", description: "Prekurzor NO. ƒåasto ≈°patn√° vst≈ôebatelnost, citrulin je lep≈°√≠ volba.", benefits: ["Kr√°tkodob√© prokrven√≠"], dosage: "3-5g", timing: "P≈ôed tr√©ninkem", synergy: ["Citrulin"], conflict: [] },
            { id: 12, name: "Maltodextrin / Cluster Dextrin", category: "S√≠la", confidence: "high", link: "https://examine.com/supplements/carbohydrates/", icon: "üç¨", description: "Rychl√© sacharidy pro doplnƒõn√≠ glykogenu.", benefits: ["Okam≈æit√° energie", "Regenerace"], dosage: "30-50g", timing: "Po tr√©ninku / P≈ôi dlouh√©m v√Ωkonu", synergy: ["Protein", "Kreatin"], conflict: ["Vl√°knina (zpomaluje)"] },

            // --- KATEGORIE: ENERGIE A NOOTROPIKA ---
            { id: 13, name: "Kofein Anhydrous", category: "Energie", confidence: "high", link: "https://examine.com/supplements/caffeine/", icon: "‚òï", description: "Nej√∫ƒçinnƒõj≈°√≠ stimulant CNS. Blokuje adenosinov√© receptory.", benefits: ["Bdƒõlost", "Soust≈ôedƒõn√≠", "V√Ωkon"], dosage: "3-6 mg/kg", timing: "P≈ôed tr√©ninkem (ne veƒçer)", synergy: ["L-Theanin"], conflict: ["Melatonin", "GABA"] },
            { id: 14, name: "L-Theanin", category: "Energie", confidence: "high", link: "https://examine.com/supplements/theanine/", icon: "üßò", description: "Aminokyselina ze zelen√©ho ƒçaje. Tlum√≠ 'jitter' a √∫zkost z kofeinu.", benefits: ["Klidn√Ω focus", "Relaxace bez √∫navy"], dosage: "100-200mg", timing: "S kofeinem", synergy: ["Kofein"], conflict: [] },
            { id: 15, name: "L-Tyrosin", category: "Energie", confidence: "high", link: "https://examine.com/supplements/l-tyrosine/", icon: "üß†", description: "Prekurzor dopaminu. Kl√≠ƒçov√Ω pro kognici pod akutn√≠m stresem.", benefits: ["Focus ve stresu", "N√°lada"], dosage: "1-2g", timing: "P≈ôed tr√©ninkem / R√°no", synergy: ["Kofein", "B-Komplex"], conflict: [] },
            { id: 16, name: "Alpha GPC", category: "Nootropika", confidence: "medium", link: "https://examine.com/supplements/alpha-gpc/", icon: "üí°", description: "Vysoce biodostupn√° forma cholinu. Palivo pro acetylcholin.", benefits: ["Pamƒõ≈•", "Uƒçen√≠", "S√≠la (neuromuskul√°rn√≠)"], dosage: "300-600mg", timing: "P≈ôed prac√≠ / tr√©ninkem", synergy: ["Huperzine A"], conflict: [] },
            { id: 17, name: "Lv√≠ h≈ô√≠va (Lion's Mane)", category: "Nootropika", confidence: "medium", link: "https://examine.com/supplements/yamabushitake/", icon: "üçÑ", description: "Medici√°ln√≠ houba podporuj√≠c√≠ r≈Øst neuron≈Ø (NGF). Dlouhodob√Ω efekt.", benefits: ["Dlouhodob√° pamƒõ≈•", "Nervov√° soustava"], dosage: "1-2g (extrakt)", timing: "R√°no", synergy: ["K√°va"], conflict: [] },
            { id: 18, name: "Rhodiola Rosea", category: "Energie", confidence: "medium", link: "https://examine.com/supplements/rhodiola-rosea/", icon: "üå∫", description: "Adaptogen sni≈æuj√≠c√≠ vn√≠m√°n√≠ √∫navy a stresu.", benefits: ["Ment√°ln√≠ energie", "Proti vyho≈ôen√≠"], dosage: "300-500mg", timing: "R√°no / P≈ôed tr√©ninkem", synergy: ["Ashwagandha"], conflict: [] },
            { id: 19, name: "Yerba Mat√©", category: "Energie", confidence: "high", link: "https://examine.com/supplements/yerba-mate/", icon: "üßâ", description: "P≈ô√≠rodn√≠ zdroj kofeinu s antioxidanty.", benefits: ["Jemn√° energie", "Tr√°ven√≠"], dosage: "Dle chuti", timing: "Dopoledne", synergy: [], conflict: [] },
            { id: 20, name: "MCT Olej (C8)", category: "Energie", confidence: "medium", link: "https://examine.com/supplements/mct-oil/", icon: "ü••", description: "Tuky, kter√© se mƒõn√≠ p≈ô√≠mo na ketony. Energie pro mozek bez inzul√≠nu.", benefits: ["Okam≈æit√° energie", "Hlad"], dosage: "10-15ml", timing: "R√°no / P≈ôed tr√©ninkem", synergy: ["K√°va"], conflict: ["Vysok√© sacharidy (tr√°ven√≠)"] },
            { id: 21, name: "Huperzine A", category: "Nootropika", confidence: "medium", link: "https://examine.com/supplements/huperzine-a/", icon: "üåø", description: "Inhibitor rozkladu acetylcholinu. Siln√Ω ale vy≈æaduje cyklov√°n√≠.", benefits: ["Kr√°tkodob√° pamƒõ≈•", "Soust≈ôedƒõn√≠"], dosage: "200mcg", timing: "R√°no (cyklovat!)", synergy: ["Alpha GPC"], conflict: [] },
            { id: 22, name: "Bacopa Monnieri", category: "Nootropika", confidence: "medium", link: "https://examine.com/supplements/bacopa-monnieri/", icon: "üå±", description: "Bylina pro dlouhodob√© zlep≈°en√≠ pamƒõti. Efekt nastupuje po t√Ωdnech.", benefits: ["Pamƒõ≈•", "√özkost"], dosage: "300mg", timing: "S j√≠dlem (tuky)", synergy: [], conflict: [] },
            { id: 23, name: "Panax Ginseng (≈Ωen≈°en)", category: "Energie", confidence: "medium", link: "https://examine.com/supplements/panax-ginseng/", icon: "üßß", description: "Tradiƒçn√≠ bylina pro vitalitu.", benefits: ["Energie", "Imunita"], dosage: "200-400mg", timing: "R√°no", synergy: [], conflict: [] },

            // --- KATEGORIE: ZDRAV√ç A HORMONY ---
            { id: 24, name: "Ho≈ôƒç√≠k Bisglycin√°t", category: "Zdrav√≠", confidence: "high", link: "https://examine.com/supplements/magnesium/", icon: "üí§", description: "Chel√°tov√° forma ho≈ôƒç√≠ku. Vysok√° vst≈ôebatelnost, nedr√°≈æd√≠.", benefits: ["Svalov√° relaxace", "Nervy", "Sp√°nek"], dosage: "300-400mg", timing: "Veƒçer", synergy: ["Zinek", "B6"], conflict: ["V√°pn√≠k (ve stejn√Ω ƒças)"] },
            { id: 25, name: "Zinek Bisglycin√°t", category: "Zdrav√≠", confidence: "high", link: "https://examine.com/supplements/zinc/", icon: "üõ°Ô∏è", description: "Kl√≠ƒçov√Ω pro imunitu a testosteron. Mnoho lid√≠ m√° deficit.", benefits: ["Testosteron", "Imunita", "Ple≈•"], dosage: "15-30mg", timing: "Veƒçer s j√≠dlem", synergy: ["Ho≈ôƒç√≠k"], conflict: ["V√°pn√≠k", "≈Ωelezo", "Vl√°knina"] },
            { id: 26, name: "Omega-3 (EPA/DHA)", category: "Zdrav√≠", confidence: "high", link: "https://examine.com/supplements/fish-oil/", icon: "üêü", description: "Ryb√≠ olej. Siln√Ω protiz√°nƒõtliv√Ω efekt.", benefits: ["Srdce", "Mozek", "Klouby"], dosage: "3-4g (kvalitn√≠ho oleje)", timing: "S j√≠dlem", synergy: ["Vitam√≠n D3"], conflict: [] },
            { id: 27, name: "Vitam√≠n D3", category: "Zdrav√≠", confidence: "high", link: "https://examine.com/supplements/vitamin-d/", icon: "‚òÄÔ∏è", description: "Hormon√°ln√≠ vitam√≠n. Z√°sadn√≠ pro imunitu.", benefits: ["Imunita", "Kosti", "Testosteron"], dosage: "2000-5000 IU", timing: "R√°no s tuky", synergy: ["Vitam√≠n K2"], conflict: ["Melatonin (ru≈°√≠ sp√°nek)"] },
            { id: 28, name: "Vitam√≠n K2 (MK-7)", category: "Zdrav√≠", confidence: "high", link: "https://examine.com/supplements/vitamin-k/", icon: "ü•¶", description: "Smƒõruje v√°pn√≠k do kost√≠ m√≠sto do c√©v.", benefits: ["Zdrav√© c√©vy", "Pevn√© kosti"], dosage: "100mcg", timing: "S j√≠dlem", synergy: ["Vitam√≠n D3"], conflict: [] },
            { id: 29, name: "Multivitam√≠n", category: "Zdrav√≠", confidence: "medium", link: "https://pubmed.ncbi.nlm.nih.gov/?term=multivitamin+health+benefits", icon: "ü•ó", description: "Z√°kladn√≠ pojistka mikro≈æivin. Vst≈ôebatelnost z√°vis√≠ na formƒõ.", benefits: ["Prevence deficit≈Ø"], dosage: "1 d√°vka", timing: "R√°no s j√≠dlem", synergy: [], conflict: [] },
            { id: 30, name: "Ashwagandha (KSM-66)", category: "Zdrav√≠", confidence: "medium", link: "https://examine.com/supplements/ashwagandha/", icon: "üåø", description: "Siln√Ω adaptogen. Sni≈æuje kortizol, co≈æ nep≈ô√≠mo zvy≈°uje testosteron.", benefits: ["Lep≈°√≠ sp√°nek", "M√©nƒõ stresu", "Testosteron"], dosage: "300-600mg", timing: "Veƒçer", synergy: [], conflict: [] },
            { id: 31, name: "Vitam√≠n C", category: "Zdrav√≠", confidence: "high", link: "https://examine.com/supplements/vitamin-c/", icon: "üçä", description: "Antioxidant nutn√Ω pro synt√©zu kolagenu.", benefits: ["Imunita", "Zdrav√≠ d√°sn√≠/k≈Ø≈æe"], dosage: "500-1000mg", timing: "R√°no", synergy: ["Kolagen"], conflict: ["Po tr√©ninku (tlum√≠ adaptaci)"] },
            { id: 32, name: "Kolagen (Hydrolyzovan√Ω)", category: "Zdrav√≠", confidence: "high", link: "https://examine.com/supplements/collagen/", icon: "ü¶¥", description: "Struktur√°ln√≠ protein. Nutn√Ω pro ≈°lachy a klouby.", benefits: ["Klouby", "Vlasy", "K≈Ø≈æe"], dosage: "10-20g", timing: "Kdykoliv", synergy: ["Vitam√≠n C"], conflict: [] },
            { id: 33, name: "NAC (N-Acetyl Cysteine)", category: "Zdrav√≠", confidence: "high", link: "https://examine.com/supplements/n-acetylcysteine/", icon: "üßπ", description: "Prekurzor Glutathionu (hlavn√≠ antioxidant). ƒåist√≠ j√°tra.", benefits: ["Zdrav√≠ jater", "Hleny/D√Ωch√°n√≠"], dosage: "600-1200mg", timing: "R√°no", synergy: ["Glycin"], conflict: ["Alkohol (souƒçasnƒõ)"] },
            { id: 34, name: "Kurkumin (s Piperinem)", category: "Zdrav√≠", confidence: "high", link: "https://examine.com/supplements/curcumin/", icon: "üçõ", description: "Siln√Ω protiz√°nƒõtliv√Ω extrakt.", benefits: ["Bolest kloub≈Ø", "Z√°nƒõtlivost"], dosage: "500mg", timing: "S j√≠dlem", synergy: ["Pep≈ô (Piperin)"], conflict: [] },
            { id: 35, name: "Probiotika", category: "Zdrav√≠", confidence: "medium", link: "https://examine.com/supplements/probiotics/", icon: "ü¶†", description: "≈Ωiv√© kultury. √öƒçinnost z√°vis√≠ na kmenu.", benefits: ["Tr√°ven√≠", "Imunita", "N√°lada"], dosage: "Dle obalu", timing: "R√°no na laƒçno", synergy: ["Vl√°knina"], conflict: ["Antibiotika"] },
            { id: 36, name: "Vitam√≠n B-Complex", category: "Zdrav√≠", confidence: "high", link: "https://pubmed.ncbi.nlm.nih.gov/?term=vitamin+b+complex+benefits", icon: "‚ö°", description: "Skupina vitam√≠n≈Ø pro energetick√Ω metabolismus.", benefits: ["Energie", "Nervov√° soustava"], dosage: "1 tbl", timing: "R√°no", synergy: [], conflict: [] },
            { id: 37, name: "Boron (B√≥r)", category: "Zdrav√≠", confidence: "medium", link: "https://examine.com/supplements/boron/", icon: "ü™®", description: "Stopov√Ω prvek, m≈Ø≈æe sni≈æovat SHBG a uvol≈àovat testosteron.", benefits: ["Voln√Ω testosteron", "Kosti"], dosage: "3-9mg", timing: "R√°no", synergy: [], conflict: [] },
            { id: 38, name: "Tongkat Ali", category: "Zdrav√≠", confidence: "medium", link: "https://examine.com/supplements/tongkat-ali/", icon: "ü™µ", description: "Bylina (Eurycoma). Popul√°rn√≠ pro libido, ale pozor na kvalitu.", benefits: ["Libido", "Voln√Ω testosteron"], dosage: "200-400mg", timing: "R√°no (cyklovat)", synergy: ["Fadogia Agrestis"], conflict: [] },
            { id: 39, name: "Maca Peru√°nsk√°", category: "Zdrav√≠", confidence: "medium", link: "https://examine.com/supplements/maca/", icon: "üç†", description: "Ko≈ôen pro vitalitu. Neovliv≈àuje testosteron, ale libido ano.", benefits: ["Libido", "Energie"], dosage: "2-5g", timing: "R√°no", synergy: [], conflict: [] },
            { id: 40, name: "Coenzyme Q10 (Ubiquinol)", category: "Zdrav√≠", confidence: "high", link: "https://examine.com/supplements/coenzyme-q10/", icon: "‚ù§Ô∏è", description: "Energie pro mitochondrie. D≈Øle≈æit√Ω po 30. roce ≈æivota.", benefits: ["Zdrav√≠ srdce", "Energie ve st√°≈ô√≠"], dosage: "100-200mg", timing: "S j√≠dlem (tuky)", synergy: [], conflict: [] },

            // --- KATEGORIE: SP√ÅNEK A RELAXACE ---
            { id: 41, name: "Melatonin", category: "Sp√°nek", confidence: "high", link: "https://examine.com/supplements/melatonin/", icon: "üåô", description: "Hormon tmy. Signalizuje ƒças sp√°t, nefunguje jako sedativum.", benefits: ["Rychlej≈°√≠ usnut√≠"], dosage: "0.5-3mg", timing: "30 min p≈ôed span√≠m", synergy: ["Br√Ωle blokuj√≠c√≠ modr√© svƒõtlo"], conflict: ["Kofein", "Alkohol"] },
            { id: 42, name: "Glycin", category: "Sp√°nek", confidence: "high", link: "https://examine.com/supplements/glycine/", icon: "üçö", description: "Aminokyselina sni≈æuj√≠c√≠ tƒõlesnou teplotu a uklid≈àuj√≠c√≠ mozek.", benefits: ["Hlubok√Ω sp√°nek", "Klid"], dosage: "3-5g", timing: "P≈ôed span√≠m", synergy: ["NAC", "Ho≈ôƒç√≠k"], conflict: [] },
            { id: 43, name: "Medu≈àka l√©ka≈ôsk√°", category: "Sp√°nek", confidence: "medium", link: "https://examine.com/supplements/lemon-balm/", icon: "üçÉ", description: "Tradiƒçn√≠ bylina pro uklidnƒõn√≠ GABA receptor≈Ø.", benefits: ["Proti stresu", "Uklidnƒõn√≠"], dosage: "300-600mg", timing: "Veƒçer", synergy: ["Valeri√°na"], conflict: [] },
            { id: 44, name: "Valeri√°na (Kozl√≠k)", category: "Sp√°nek", confidence: "medium", link: "https://examine.com/supplements/valerian/", icon: "üåø", description: "Siln√° bylina pro sedaci. M≈Ø≈æe zp≈Øsobovat rann√≠ ospalost.", benefits: ["Rychl√© usnut√≠"], dosage: "300-500mg", timing: "P≈ôed span√≠m", synergy: ["Medu≈àka"], conflict: [] },
            { id: 45, name: "GABA", category: "Sp√°nek", confidence: "medium", link: "https://examine.com/supplements/gaba/", icon: "üßò‚Äç‚ôÇÔ∏è", description: "Neurotransmiter. ≈†patnƒõ proch√°z√≠ do mozku, ale m≈Ø≈æe uvolnit tƒõlo.", benefits: ["Relaxace", "R≈Østov√Ω hormon"], dosage: "500-1000mg", timing: "Veƒçer", synergy: [], conflict: [] },
            { id: 46, name: "Tryptofan", category: "Sp√°nek", confidence: "high", link: "https://examine.com/supplements/tryptophan/", icon: "ü¶É", description: "Stavebn√≠ k√°men pro serotonin a melatonin.", benefits: ["N√°lada", "Sp√°nek"], dosage: "500-1000mg", timing: "Veƒçer", synergy: ["Sacharidy"], conflict: ["Antidepresiva (SSRI)"] },
            { id: 47, name: "Apigenin", category: "Sp√°nek", confidence: "medium", link: "https://examine.com/supplements/apigenin/", icon: "üåº", description: "Bioflavonoid z he≈ôm√°nku. Uklid≈àuje mysl.", benefits: ["Snadn√© us√≠n√°n√≠", "Prostata"], dosage: "50mg", timing: "Veƒçer", synergy: ["Ho≈ôƒç√≠k", "Theanin"], conflict: [] },
            { id: 48, name: "Tart Cherry (Vi≈°e≈à)", category: "Sp√°nek", confidence: "high", link: "https://examine.com/supplements/tart-cherry/", icon: "üçí", description: "P≈ô√≠rodn√≠ zdroj melatoninu a siln√Ωch antioxidant≈Ø.", benefits: ["Regenerace", "Sp√°nek"], dosage: "Dle produktu", timing: "Veƒçer", synergy: [], conflict: [] },
            { id: 49, name: "Glutamin", category: "Zdrav√≠", confidence: "high", link: "https://examine.com/supplements/glutamine/", icon: "üõ°Ô∏è", description: "Palivo pro imunitu a st≈ôevn√≠ bu≈àky.", benefits: ["Imunita", "St≈ôeva"], dosage: "5g", timing: "Po tr√©ninku / Veƒçer", synergy: [], conflict: [] },
            { id: 50, name: "Psyllium (Vl√°knina)", category: "Zdrav√≠", confidence: "high", link: "https://examine.com/supplements/psyllium/", icon: "üåæ", description: "Rozpustn√° vl√°knina. Mechanicky ƒçist√≠ st≈ôeva.", benefits: ["Tr√°ven√≠", "Cholesterol"], dosage: "5-10g", timing: "R√°no/Veƒçer (s vodou)", synergy: ["Probiotika"], conflict: ["L√©ky (sni≈æuje vst≈ôeb√°v√°n√≠)"] }
        ];

        // --- 2. STATE & SETUP ---
        const state = { stack: new Set(), weight: 80, gender: "male", search: "", category: "All", savedStacks: {} };
        const grid = document.getElementById("catalog-grid");
        const wInput = document.getElementById("user-weight");
        const modal = document.getElementById("modal-backdrop");
        const modalContent = document.getElementById("modal-content");

        function showToast(msg, type = 'success') {
            const c = document.getElementById('toast-container');
            const t = document.createElement('div');
            let color = type === 'error' ? 'bg-red-500' : (type === 'warn' ? 'bg-yellow-500' : 'bg-green-500');
            t.className = `toast ${color} text-white px-4 py-3 rounded-lg shadow-xl font-medium flex items-center gap-3`;
            t.innerHTML = `<span>${type === 'success' ? '‚úÖ' : '‚ö†Ô∏è'}</span> ${msg}`;
            c.appendChild(t);
            setTimeout(() => { t.style.opacity = '0'; setTimeout(() => t.remove(), 300); }, 3000);
        }

        function init() {
            // --- INICIALIZACE Z LOK√ÅLN√çHO √öLO≈ΩI≈†Tƒö ---
            try {
                const s = JSON.parse(localStorage.getItem('bioStack_pro_final'));
                if (s) {
                    state.stack = new Set(s.stack);
                    state.weight = s.weight || 80;
                    state.gender = s.gender || "male";
                    state.savedStacks = s.savedStacks || {};
                }
            } catch (e) { }

            wInput.value = state.weight;
            document.getElementById("user-gender").value = state.gender;

            // --- VYKRESLEN√ç PRVK≈Æ ---
            render();
            analyze();
            renderSavedProfiles();
            setupEvents();
        }

        function save() {
            localStorage.setItem('bioStack_pro_final', JSON.stringify({
                stack: [...state.stack],
                weight: state.weight,
                gender: state.gender,
                savedStacks: state.savedStacks
            }));
        }

        function validateWeight() {
            let v = parseInt(wInput.value);
            if (isNaN(v)) v = 80;
            if (v < 40) { v = 40; showToast("Minimum je 40kg", "warn"); }
            if (v > 180) { v = 180; showToast("Maximum je 180kg", "warn"); }
            state.weight = v; wInput.value = v;
            save(); analyze();
        }

        // --- LOGIC: Dosage & Confidence ---
        function getDosage(item) {
            const w = state.weight;
            if (item.id === 2) return `${Math.round(w * 0.35)}g (dle stravy)`; // Protein
            if (item.id === 13) return `max 400 mg (bezpeƒç√≠)`;
            return item.dosage;
        }

        function analyze() {
            const items = [...state.stack].map(id => supplements.find(s => s.id === id));

            // Profile & Count
            document.getElementById("profile-display").innerText = `${state.gender === 'male' ? 'Mu≈æ' : '≈Ωena'}, ${state.weight}kg`;
            document.getElementById("stack-count").innerText = items.length;

            const empty = document.getElementById("stack-empty");
            const analysis = document.getElementById("stack-analysis");

            if (items.length === 0) {
                empty.classList.remove("hidden");
                analysis.classList.add("hidden");
                return;
            }
            empty.classList.add("hidden");
            analysis.classList.remove("hidden");

            // Slots
            const slots = {
                morning: document.getElementById("schedule-morning"),
                pre: document.getElementById("schedule-pre"),
                post: document.getElementById("schedule-post"),
                evening: document.getElementById("schedule-evening")
            };
            Object.values(slots).forEach(el => el.innerHTML = "");

            items.forEach(i => {
                const dose = getDosage(i);
                // Confidence color for badge border
                const confColor = i.confidence === 'high' ? 'border-green-300' : 'border-yellow-300';
                
                const badge = `<div class="flex justify-between items-center bg-white border-l-4 ${confColor} shadow-sm p-2 rounded-r text-xs mb-1">
                    <span class="font-bold text-slate-700">${i.name}</span>
                    <span class="text-brand-600 font-mono">${dose}</span>
                </div>`;

                const t = i.timing.toLowerCase();
                let placed = false;
                if (t.match(/r√°no|dopoledne/)) { slots.morning.innerHTML += badge; placed = true; }
                if (t.match(/p≈ôed/)) { slots.pre.innerHTML += badge; placed = true; }
                if (t.match(/po tr√©ninku/)) { slots.post.innerHTML += badge; placed = true; }
                if (t.match(/veƒçer|span√≠m/)) { slots.evening.innerHTML += badge; placed = true; }
                if (!placed) slots.morning.innerHTML += badge;
            });

            // Warnings logic
            const warns = [];
            for (let i = 0; i < items.length; i++) {
                for (let j = i + 1; j < items.length; j++) {
                    const a = items[i], b = items[j];
                    if (a.conflict && a.conflict.some(c => b.name.includes(c))) warns.push(`${a.name} vs ${b.name}`);
                    if ((a.name.includes("Zinek") && b.name.includes("V√°pn√≠k")) || (b.name.includes("Zinek") && a.name.includes("V√°pn√≠k"))) warns.push("V√°pn√≠k blokuje Zinek (2h rozestup)");
                }
            }
            const wList = document.getElementById("warnings-list");
            wList.innerHTML = warns.map(w => `<li>${w}</li>`).join("");
            document.getElementById("warnings-container").classList.toggle("hidden", warns.length === 0);

            // Suggestions logic
            const suggs = [];
            const ids = items.map(i => i.id);
            if (ids.includes(1) && !ids.includes(8) && !ids.includes(5)) suggs.push("Ke Kreatinu zkus Beta-Alanin pro v√Ωdr≈æ.");
            if (ids.includes(10) && !ids.includes(13)) suggs.push("D3 funguje l√©pe s K2.");
            if (ids.includes(25) && !ids.includes(24)) suggs.push("Zinek je dobr√© br√°t s Ho≈ôƒç√≠kem (ZMA efekt).");
            
            const sList = document.getElementById("suggestions-list");
            sList.innerHTML = suggs.map(s => `<li>${s}</li>`).join("");
            document.getElementById("suggestions-container").classList.toggle("hidden", suggs.length === 0);
        }

        function render() {
            grid.innerHTML = "";
            const filtered = supplements.filter(i => {
                const term = state.search.toLowerCase();
                const cat = state.category;
                return (cat === "All" || i.category === cat) && (i.name.toLowerCase().includes(term) || i.description.toLowerCase().includes(term));
            });

            if (filtered.length === 0) { grid.innerHTML = `<div class="col-span-full text-center text-slate-400 py-10">Nic nenalezeno</div>`; return; }

            filtered.forEach(i => {
                const active = state.stack.has(i.id);
                const btnIcon = active ? `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>` : `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>`;
                const btnClass = active ? "bg-green-500 text-white shadow-green-200" : "bg-white text-slate-400 border border-slate-200 hover:border-brand-500 hover:text-brand-500";
                
                // Confidence visual
                const confClass = i.confidence === 'high' ? 'conf-high' : 'conf-medium';

                grid.innerHTML += `
                <div class="bg-white rounded-2xl p-5 border border-slate-100 shadow-sm card-hover flex flex-col relative ${confClass}">
                    <div class="flex justify-between items-start mb-3 cursor-pointer" onclick="openModal(${i.id})">
                        <div class="w-12 h-12 flex items-center justify-center rounded-xl text-2xl icon-bg-${i.category}">${i.icon}</div>
                        <span class="text-[10px] font-bold uppercase tracking-wide px-2 py-1 rounded-full cat-badge-${i.category}">${i.category}</span>
                    </div>
                    <h3 class="font-bold text-slate-900 text-lg mb-1 leading-tight cursor-pointer hover:text-brand-600 transition" onclick="openModal(${i.id})">${i.name}</h3>
                    <p class="text-sm text-slate-500 mb-4 line-clamp-2">${i.description}</p>
                    <div class="mt-auto pt-4 border-t border-slate-50 flex justify-between items-center">
                        <button onclick="openModal(${i.id})" class="text-xs font-bold text-slate-400 hover:text-slate-600 uppercase">Detail</button>
                        <button onclick="toggle(${i.id})" class="w-10 h-10 rounded-full flex items-center justify-center shadow-sm transition-all ${btnClass}">${btnIcon}</button>
                    </div>
                </div>`;
            });
        }

        function toggle(id) {
            if (state.stack.has(id)) { state.stack.delete(id); showToast("Odebr√°no", "warn"); }
            else { state.stack.add(id); showToast("P≈ôid√°no"); }
            save(); render(); analyze();

            // Update modal btn
            const btn = document.getElementById("m-toggle-btn");
            if (btn && !modal.classList.contains("hidden")) {
                const active = state.stack.has(id);
                btn.innerText = active ? "Odebrat" : "P≈ôidat do Stacku";
                btn.className = `w-full sm:w-auto text-white px-8 py-3 rounded-xl font-semibold transition shadow-lg ${active ? 'bg-red-500 hover:bg-red-600' : 'bg-slate-900 hover:bg-slate-800'}`;
            }
        }

        function clearStack() {
            if (confirm("Opravdu vymazat cel√Ω stack?")) { state.stack.clear(); save(); render(); analyze(); showToast("Stack vymaz√°n", "warn"); }
        }

        // --- EXPORT & PROFILES & COPY ---
        
        // Helper: Generates the report text for both export and copy
        function getStackReportContent() {
            const items = [...state.stack].map(id => supplements.find(s => s.id === id));
            const date = new Date().toLocaleDateString('cs-CZ');
            
            let txt = `SUPPLEMENT GUIDE REPORT\nDatum: ${date}\nProfil: ${state.gender === 'male'?'Mu≈æ':'≈Ωena'}, ${state.weight}kg\n\n`;
            txt += `--- ROZVRH DNE ---\n`;
            
            const slots = { "R√°no / Dopoledne": [], "P≈ôed tr√©ninkem": [], "Po tr√©ninku": [], "Veƒçer": [] };
            items.forEach(i => {
                const t = i.timing.toLowerCase();
                const line = `- ${i.name} (${getDosage(i)})`;
                if(t.match(/r√°no|dopoledne/)) slots["R√°no / Dopoledne"].push(line);
                else if(t.match(/p≈ôed/)) slots["P≈ôed tr√©ninkem"].push(line);
                else if(t.match(/po/)) slots["Po tr√©ninku"].push(line);
                else slots["Veƒçer"].push(line);
            });

            for(const [time, lines] of Object.entries(slots)) {
                if(lines.length) {
                    txt += `\n[ ${time.toUpperCase()} ]\n${lines.join('\n')}\n`;
                }
            }
            txt += `\n--- POZN√ÅMKY ---\nVygenerov√°no aplikac√≠ Supplement Guide.`;
            return txt;
        }

        function saveStackProfile() {
            if(state.stack.size === 0) return showToast("Stack je pr√°zdn√Ω", "warn");
            const name = prompt("Pojmenuj tento stack (nap≈ô. 'Objem Zima'):");
            if(name) {
                state.savedStacks[name] = [...state.stack];
                save(); renderSavedProfiles(); showToast("Profil ulo≈æen");
            }
        }

        function loadProfile(name) {
            if(confirm(`Naƒç√≠st stack "${name}"? Souƒçasn√Ω v√Ωbƒõr bude p≈ôeps√°n.`)) {
                state.stack = new Set(state.savedStacks[name]);
                save(); render(); analyze(); showToast("Profil naƒçten");
            }
        }

        function deleteProfile(name) {
            if(confirm(`Smazat profil "${name}"?`)) {
                delete state.savedStacks[name];
                save(); renderSavedProfiles();
            }
        }

        function renderSavedProfiles() {
            const list = document.getElementById("saved-profiles-list");
            const container = document.getElementById("saved-profiles-area");
            const names = Object.keys(state.savedStacks);
            
            if(names.length === 0) { container.classList.add("hidden"); return; }
            container.classList.remove("hidden");
            
            list.innerHTML = names.map(n => `
                <div class="flex justify-between items-center bg-slate-50 p-2 rounded text-xs">
                    <span class="font-bold text-slate-700 cursor-pointer hover:text-brand-600" onclick="loadProfile('${n}')">${n}</span>
                    <button onclick="deleteProfile('${n}')" class="text-slate-400 hover:text-red-500">‚úï</button>
                </div>
            `).join("");
        }

        function exportStackText() {
            if (state.stack.size === 0) return showToast("Stack je pr√°zdn√Ω", "warn");
            const txt = getStackReportContent();
            const date = new Date().toLocaleDateString('cs-CZ');

            const blob = new Blob([txt], { type: "text/plain" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `Muj_Stack_${date}.txt`;
            a.click();
            showToast("Soubor sta≈æen");
        }
        
        async function copyStackToClipboard() {
             if (state.stack.size === 0) return showToast("Stack je pr√°zdn√Ω", "warn");
             const txt = getStackReportContent();
             try {
                 // Pou≈æ√≠v√° modern√≠ Clipboard API
                 await navigator.clipboard.writeText(txt);
                 showToast("Zkop√≠rov√°no do schr√°nky");
             } catch (err) {
                 // Fallback pro star≈°√≠ prohl√≠≈æeƒçe
                 showToast("Chyba kop√≠rov√°n√≠", "error");
             }
        }

        // --- MODAL ---
        function openModal(id) {
            const i = supplements.find(s => s.id === id);
            
            // Set Dynamic Colors/Classes
            const catClass = `cat-badge-${i.category}`;
            const catEl = document.getElementById("m-category");
            catEl.className = `text-[10px] font-bold uppercase tracking-widest px-2 py-0.5 rounded border ${catClass}`;
            document.getElementById("m-icon").className = `w-14 h-14 rounded-2xl flex items-center justify-center text-3xl shadow-inner icon-bg-${i.category}`;
            document.getElementById("m-icon").innerHTML = i.icon;

            // Confidence Badge as Link
            const confEl = document.getElementById("m-confidence");
            const isHigh = i.confidence === 'high';
            const label = isHigh ? "‚úÖ Ovƒõ≈ôeno" : "‚ö†Ô∏è M√©nƒõ dat";
            const bgClass = isHigh ? "badge-conf-high" : "badge-conf-medium";
            
            // Generate Clickable Badge with External Link Icon
            confEl.innerHTML = `
                <a href="${i.link}" target="_blank" class="badge-conf-link text-[10px] font-bold uppercase tracking-widest px-2 py-0.5 rounded border ${bgClass}" title="Otev≈ô√≠t vƒõdeck√Ω zdroj">
                    ${label}
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                </a>
            `;

            document.getElementById("m-category").innerText = i.category;
            document.getElementById("m-title").innerText = i.name;
            document.getElementById("m-desc").innerText = i.description;
            document.getElementById("m-dosage").innerText = getDosage(i);
            document.getElementById("m-timing").innerText = i.timing;

            const list = (arr, el) => document.getElementById(el).innerHTML = arr.length ? arr.map(x => `<span class="inline-block bg-slate-100 text-slate-600 text-xs px-2 py-1 rounded mr-1 mb-1 border border-slate-200">${x}</span>`).join("") : '<span class="text-slate-300 italic text-xs">≈Ω√°dn√©</span>';
            list(i.synergy || [], "m-synergy"); 
            list(i.conflict || [], "m-conflict");
            document.getElementById("m-benefits").innerHTML = i.benefits.map(b => `<li>‚úÖ ${b}</li>`).join("");

            const btn = document.getElementById("m-toggle-btn");
            const active = state.stack.has(id);
            btn.innerText = active ? "Odebrat" : "P≈ôidat do Stacku";
            btn.className = `w-full sm:w-auto text-white px-8 py-3 rounded-xl font-semibold transition shadow-lg ${active ? 'bg-red-500 hover:bg-red-600' : 'bg-slate-900 hover:bg-slate-800'}`;
            btn.onclick = () => { toggle(id); closeModal(); };

            modal.classList.remove("hidden");
            setTimeout(() => { modal.classList.remove("opacity-0"); modalContent.classList.remove("scale-95"); modalContent.classList.add("scale-100"); }, 10);
            document.body.style.overflow = "hidden";
        }

        function closeModal() {
            modal.classList.add("opacity-0"); modalContent.classList.remove("scale-100"); modalContent.classList.add("scale-95");
            setTimeout(() => { modal.classList.add("hidden"); document.body.style.overflow = "auto"; }, 300);
        }

        function setupEvents() {
            wInput.addEventListener("change", validateWeight);
            document.getElementById("user-gender").addEventListener("change", (e) => { state.gender = e.target.value; save(); analyze(); });
            document.getElementById("search-input").addEventListener("input", (e) => { state.search = e.target.value; render(); });

            document.querySelectorAll(".filter-btn").forEach(btn => {
                btn.addEventListener("click", () => {
                    document.querySelectorAll(".filter-btn").forEach(b => b.className = "filter-btn px-4 py-1.5 rounded-full text-xs font-medium bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 transition");
                    btn.className = "filter-btn active px-4 py-1.5 rounded-full text-xs font-bold bg-slate-800 text-white shadow transition transform hover:scale-105";
                    state.category = btn.dataset.cat; render();
                });
            });

            modal.addEventListener("click", e => { if (e.target === modal) closeModal(); });
            document.addEventListener('keydown', e => { if (e.key === "Escape") closeModal(); });
        }

        init();
    </script>
</body>
</html>